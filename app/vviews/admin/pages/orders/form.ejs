<% include ./../../helpers/get-address %>
<% include ./../../helpers/selectBox %>

<% 
	const collection = "orders";
	const linkPrefix = systemConfig.prefixAdmin + `/${collection}/`;
%>
<section class="content" id="invoice">
	<div class="container-fluid">
	  <div class="row">
		<div class="col-12">
		  <div class="invoice p-3 mb-3">
			<div class="row">
			  <div class="col-12">
				<h4>
				  <i class="fas fa-globe"></i> Fashion Shop, Inc.
				  <small class="float-right">Date: <%= moment(item.time).format(systemConfig.format_date) %></small>
				</h4>
				<div class="form-group">
					<label>Status</label>
					<%- selectBoxHelper('filter-progress', systemConfig.orders_state_value, item.status, item.id ) %>
				</div>
			  </div>
			</div>
			<div class="row invoice-info">
			  <div class="col-sm-4 invoice-col">
				From
				<address>
				  <strong>Admin - Fashion Shop, Inc.</strong><br>
				  <%= infoConfig.address.split(',')[0] %>, <br>
				  <%= infoConfig.address.split(',')[1] %>, <%= infoConfig.address.split(',')[2] %> <br>
				  Phone: <%= infoConfig.hotline %> <br>
				  Email: <%= infoConfig.email %> 
				</address>
			  </div>
			  <div class="col-sm-4 invoice-col">
				To
				<address>
				  <strong><%= item.user.name%></strong><br>
				  <%= addressHelper(item.user.address)[0] %><br>
				  <%= addressHelper(item.user.address)[1] %><br>
				  Phone: <%= item.user.phone %><br>
				  Email: <%= item.user.email %>
				</address>
			  </div>
			  <div class="col-sm-4 invoice-col">
				<b>Invoice #<%= item.code %></b><br>
				<br>
				<b>Order ID:</b> <%= item.id %><br>
				<b>Payment Due:</b> <%= moment(item.time).format(systemConfig.format_date_2) %><br>
			  </div>
			</div>
			<div class="row">
			  <div class="col-12 table-responsive">
				<table class="table table-striped">
				  <thead>
				  <tr>
					<th>ID</th>
					<th>Product</th>
					<th>Type</th>
					<th>Quantity</th>
					<th>Price</th>
				  </tr>
				  </thead>
				  <tbody>
					<% item.product.forEach( (data) => { %>
						<tr>
							<td><%= data.id %></td>
							<td>
								<%= data.name %>
								<% if('size' in data && data.size != null) { %>  
									- Size: <%= data.size %>
								<% } %>
							</td>
							<td><%= data.product_type %></td>
							<td><%= data.quantity %></td>
							<td>$<%= data.price %></td>
						</tr>
					<% }) %>
				  </tbody>
				</table>
			  </div>
			</div>
			<div class="row">
				<div class="col-6">
					<p class="lead">Payment Method: <%= item.payment.charAt(0).toUpperCase() + item.payment.slice(1) %></p>
					<% if(item.promo_code.name !== undefined) { %>
						<p class="lead">Promo code:</p>
						<p class="text-muted well well-sm shadow-none" style="margin-top: 10px;">
							<%= item.promo_code.name %>
						</p>
					<% } %>
					<p class="lead">Message:</p>
					<p class="text-muted well well-sm shadow-none" style="margin-top: 10px;">
						<%= item.user.message %>
					</p>
				</div>
			  <div class="col-6">
				<p class="lead">Amount Due <%= moment(item.time).format(systemConfig.format_date) %></p>
				<div class="table-responsive">
				  <table class="table">
					<tbody>
					<tr>
					  <th>Shipping:</th>
					  <td>$<%= item.shipping_fee %></td>
					</tr>
					<% if(item.promo_code.name !== undefined) { %>
						<tr>
							<th>Promotional value :</th>
							<td>$<%= item.promo_code.value %></td>
						</tr>
					<% } %>
					<tr>
					  <th>Total:</th>
					  <td>$<%= item.total %></td>
					</tr>
				  </tbody></table>
				</div>
			  </div>
			</div>
			<div class="row no-print">
			  <div class="col-12">
				<a href="<%= linkPrefix %>" rel="noopener" class="btn btn-danger">
					<i class="fas fa-arrow-alt-circle-left"></i> Return
				</a>
				<a href="<%= linkPrefix %>print/<%= item._id %>" target="_blank" class="btn btn-primary float-right">
				  <i class="fas fa-print"></i> Print
				</a>
			  </div>
			</div>
		  </div>
		</div>
	  </div>
	</div>
</section>
